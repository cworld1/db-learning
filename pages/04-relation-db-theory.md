# 第 4 章 关系数据库理论

前面已经讲述了关系数据库、关系模型的基本概念以及关系数据库的标准语言。如何使用关系模型设计关系数据库，也就是面对一个现实问题，如何选择一个比较好的关系模式的集合，每个关系又应该由哪些属性组成，这属于数据库设计的问题，确切地讲是数据库逻辑设计的问题。

## 规范化问题的提出

关系数据库的规范化理论主要包括三个方面的内容：**函数依赖**、**范式（Normal Form）**和**模式设计**。其中函数依赖起着核心的作用，是模式分解和模式设计的基础，范式是模式分解的标准。

- 针对具体问题，应该如何构造一个适合于它的数据库模式，即应该构造几个关系模式，每个关系由哪些属性组成等。
- 人们以关系模型为背景讨论这个问题，形成了数据库逻辑设计的工具——关系数据库的规范化理论。

> 下面会讲一个例子关于我们为什么要用规范化的关系数据库，非重点内容，可以随意跳过或浅尝辄止。

如：要求设计教学管理数据库，其关系模式 SCD 如下：

```sql
SCD（SNo，SN，Age，Dept，MN，CNo，Score）
```

其中，SNo 表示学生学号，SN 表示学生姓名，Age 表示学生年龄，Dept 表示学生所在的系别，MN 表示系主任姓名，CNo 表示课程号，Score 表示成绩。

根据实际情况，SCD 的这些数据具有如下语义规定：

1. 一个系有若干名学生，但一名学生只属于一个系；
2. 一个系只有一名系主任，但一名系主任可以同时兼几个系的系主任；
3. 一名学生可以选修多门功课，每门课程可被若干名学生选修；
4. 每名学生学习的课程有一个成绩，但不一定立即给出。

在此关系模式中填入一部分具体的数据，则可得到 SCD 关系模式的实例，即一个教学管理数据库。

根据上述的语义规定分析以上教学管理数据库，可以看出，（SNo，CNo）属性的组合能唯一标识一个元组，即可以通过（SNo，CNo）的取值分辨不同学生记录，所以（SNo，CNo）是该关系模式的主码。若使用上述数据库建立教学管理信息系统，则会出现以下几方面的问题：

1. 数据冗余。每个系名和系主任名字的存储次数等于该系学生人数乘以每个学生选修的课程门数，同时学生的姓名、年龄也都要重复存储多次，数据的冗余度很大，浪费了存储空间。
2. 插入异常。如果某个新系没有招生，尚无学生时，则系名和系主任的信息无法插入到数据库中。因为在这个关系模式中，（SNo，CNo）是主码。根据关系的实体完整性约束，任何记录的主码的值不能为空，由于该系没有学生，SNo 和 CNo 均无值，因此不能进行插入操作。另外，当某个学生尚未选课，同样也不能进行插入操作，主要原因是 CNo 未知，实体完整性约束还规定，主码的值不能部分为空。
3. 删除异常。当某系学生全部毕业而没有招生时，要删除全部学生的记录，这时系名、系主任也随之删除，而现实中这个系可能依然存在，但在数据库中却无法找到该系的信息。另外，如果某个学生不再选修 C1 课程，本应该只删去 C1，但 C1 是主码的一部分，为保证实体完整性，必须将整个元组一起删掉，这样，元组中有关该学生的其他信息也随之丢失。
4. 更新异常。如果某学生改名，则该学生的所有记录都要逐一修改 SN 的值；又如某系更换系主任，则属于该系的学生记录都要修改 MN 的内容，稍有不慎，就有可能漏改某些记录，这就会造成数据的不一致性，破坏了数据的完整性。

由于存在以上问题，可以说，SCD 是一个不好的关系模式。产生上述问题的原因，直观地说，是因为关系中“包罗万象”，内容过于全面。我们一般把原来的关系模式 SCD 称为泛模式，泛模式用一个大表存放所有的数据。

优化后，我们把关系模式 SCD 分解为学生关系 S（SNo， SN，Age，Dept）、选课关系 SC（SNo，CNo，Score）和系关系 D（Dept，MN）三个结构简单的关系模式。

经过上述分析，我们说分解后的关系模式是一个规范的关系数据库模式。从而得出结论，一个规范的关系模式应该具备以下四个条件：

1. 尽可能少的数据冗余。
2. 没有插入异常。
3. 没有删除异常。
4. 没有更新异常。

按照一定的规范设计关系模式，将结构复杂的关系分解成结构简单的关系，从而把不规范的关系数据库模式转变为规范的关系数据库模式，这就是关系的规范化。

> 关系模式是一个五元组：
>
> $$
> R(U,D,\text{DOM},F)
> $$
>
> - 关系名 R 是符号化的元组语义
> - U 为一组属性
> - D 为 U 中的属性所来自的域
> - DOM 为属性到域的映射
> - F 为 U 上的一组数据依赖

## 函数依赖
